<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Max 6 API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
	<div id="c74header">
		<img src="header.png" height="100" />
	</div>
</div>
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('chapter_platform.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Development System Information </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="chapter_platform_building"></a>
Building</h1>
<p>This SDK documentation is accompanied by a series of projects for compiling some example Max external objects. The details of how to build these projects are documented below in separate sections for the <a class="el" href="chapter_platform.html#chapter_platform_mac">Mac</a> and <a class="el" href="chapter_platform.html#chapter_platform_win">Windows</a>.</p>
<p>When you build the example projects, the resulting Max external will be located in a folder called "externals" at the top level of the SDK package. This is located a couple of folders up from the project and source file.</p>
<p>Place the SDK package in your "Packages" folder in order to load and test the externals you build in Max itself.</p>
<h1><a class="anchor" id="chapter_platform_buildscript"></a>
Build Script</h1>
<p>We have provided a basic script that will build all of the projects in the SDK at once. This script is written using the Ruby language. A Ruby interpretter is standard on the Mac. On windows you can download and install Ruby (1.9.3 recommended) from <a href="http://rubyinstaller.org/">http://rubyinstaller.org/</a> .</p>
<p>Run from Terminal.app (Mac) or a Command Prompt (Windows) by cd'ing into the examples directory, and then running: </p><div class="fragment"><div class="line">ruby build.rb</div>
</div><!-- fragment --><h1><a class="anchor" id="chapter_platform_mac"></a>
Mac</h1>
<p>Max external objects for the Mac are Mach-O bundles (folders that appear to be files) whose filenames must end with the .mxo extension. The example projects have been tested using Xcode 6.2. Xcode is available through the Apple Mac Store.</p>
<p>After installing Xcode, if you wish to run the aforementioned Ruby script, you will also need to install the Command Line Tools. This is done via the menu item: Xcode &gt; Open Developer Tool &gt; More Development Tools...</p>
<h2><a class="anchor" id="chapter_platform_mac_xcodeproj"></a>
XCode Project Setup</h2>
<p>The example projects are set up to have Development and Deployment build configurations. The Development configuration does not optimize and ensures debugging symbols are present. The Deployment configuration creates a universal binary and performs optimization.</p>
<p>The files required for the projects are included in the project folders with the exception of the following two files:</p><ul>
<li>Info.plist</li>
<li>maxmspsdk.xcconfig</li>
</ul>
<p>These two files are located one folder-level up from the project folder, and are required for the Xcode project to build the Max external.</p>
<h2><a class="anchor" id="chapter_platform_mac_linking"></a>
Linking and Frameworks</h2>
<p>External objects use dynamic linking to access the API functions provided by the Max application. When an object is loaded, calls to functions inside the application are resolved by the operating system to the correct memory address. Due to the fact that "Max" could exist as an application, a standalone you create, or a library inside another application, an object's Xcode project does not link directly to a framework, library, or application. Instead, the list of permitted symbols is provided to the linker. This list is defined in the aforementioned maxmspsdk.xcconfig file.</p>
<p>Audio objects will link against MaxAudioAPI.framework and Jitter objects link against JitterAPI.framework. Alternatively, you could also provide linker flags as we have provided for Max itself. The most recent version of all frameworks will be found inside the application you are using (they are found inside the application bundle in Contents/Frameworks). In addition, there are versions inside the c74support folder provided with the SDK. These will be used only to link your objects; they are never actually executed.</p>
<p>Xcode uses something called the Frameworks Search Path to locate frameworks when linking. The example SDK projects use a frameworks search path with a c74support folder two levels up from your the folder containing your Xcode project. If you rearrange the SDK folders, projects may not find the frameworks and will fail to link properly. Furthermore, even though we specify the frameworks search path, Xcode seems to look in /Library/Frameworks first. If you have installed a version of the Max SDK for version 4.6 or ealier, you may have older versions of MaxAPI.framework and MaxAudioAPI.framework in /Library/Frameworks. When you try to link objects that contain references to functions only defined in the newest MaxAPI.framework, the link may fail because the projects are using the old frameworks. To fix this, you'll need to remove the Max frameworks from /Library/Frameworks. If you want to develop objects for both the Max 4.6 and Max 5 SDKs on the same machine, you'll need to modify your 4.6 projects to specify a Frameworks Search Path, and relocate the 4.6 frameworks to the specified location.</p>
<h1><a class="anchor" id="chapter_platform_win"></a>
Windows</h1>
<p>Max external objects for Windows are Dynamic Link Libraries (DLLs) whose filenames must end with the .mxe extension (for 32-bit builds) or .mxe64 (for 64-bit builds). These DLLs will export a single function called "ext_main" which is called by max when the external object is first loaded. Generally these DLLs will import functions of the Max API from the import library "MaxAPI.lib" which is located in the c74support\max-includes\ folder. External objects that use audio functionality will import functions from the import library "MaxAudio.lib" which is located in c74support\msp-includes\. External objects that use Jitter functionality will import functions from the import library "jitlib.lib" which is located in c74support\jit-includes\.</p>
<h2><a class="anchor" id="chapter_platform_win_vs"></a>
Compiling with Visual Studio</h2>
<p>The example projects are in Visual C++ 2013 format (vcxproj files). A free version of Visual C++ can be obtained from Microsoft at <a href="http://www.microsoft.com/express/">http://www.microsoft.com/express/</a>. You will want to choose "Visual Studio Express 2013 for Windows Desktop".</p>
<p>The projects are set up to have both a Debug and a Release configuration. The Release configuration is optimized whereas the Debug one is not. Note that for debugging purposes you can exercise your object in the Max Runtime since the copy protection for the Max Application will interfere when run under the debugger.</p>
<p>Another thing to note is that Max has a private build of the Microsoft C Runtime Library for historical and backward compatibility reasons. It is recommended that you link with Microsoft's standard C runtime library rather than the Max C runtime library. When you include "ext.h" from the max API it will include ext_prefix.h which for the release build will automatically cause your project to use the max C runtime library. To use the Microsoft C Runtime define the C preprocessor macro MAXAPI_USE_MSCRT before including ext.h.</p>
<h1><a class="anchor" id="chapter_platform_settings"></a>
Important Project Settings</h1>
<p>The easiest way to create a new external is to choose one of the existing SDK examples, duplicate it, and then change only the settings that need to be changes (such as the name of the project). This will help to guarantee that important project settings are correct. Project settings of particular importance are noted below.</p>
<h2><a class="anchor" id="chapter_platform_settings_mac"></a>
Mac</h2>
<p>Particularly important for Max externals on the Mac are that the Info.plist is correct set up and that the "Force Package Info Generation" is set to true. Without these your object may fail to load on some machines.</p>
<h2><a class="anchor" id="chapter_platform_settings_win"></a>
Windows</h2>
<p>In the preprocessor definitions for the Visual Studio project it is important to define WIN_VERSION and EXT_WIN_VERSION to ensure that the headers are set up properly.</p>
<h1><a class="anchor" id="chapter_platform_specificity"></a>
Platform-specificity</h1>
<p>If you are writing a cross-platform object and you need to do something that is specific to one platform, the Max API headers provide some predefined symbols you can use.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifdef MAC_VERSION</span></div>
<div class="line"><span class="comment">// do something specific to the Mac</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#ifdef WIN_VERSION</span></div>
<div class="line"><span class="comment">// do something specific to Windows</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>Another reason for conditional compilation is to handle endianness on the Mac platform. If you are still supporting PowerPC, you may have situations where the ordering of bytes within a 16- or 32-bit word is important. ext_byteorder.h provides cross-platform tools for manipulating memory in an endian-independent way.</p>
<h1><a class="anchor" id="chapter_platform_configuration"></a>
Configuration</h1>
<p>As the Max API evolves, the use of a number of older legacy functions are discouraged. Use of said functions will issue a 'deprecation' warning when you try to compile the code. To disable these deprecation warnings you can define the preprocessor symbol C74_NO_DEPRECATION in the target preprocessor section of your IDE. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
		<div id="c74footer">
			&nbsp;&nbsp;Copyright &copy; 2013, <a href="http://www.cycling74.com/">Cycling '74</a>
		</div>
	</body>
</html>
