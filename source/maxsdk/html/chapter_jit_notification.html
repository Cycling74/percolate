<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Max 6 API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
	<div id="c74header">
		<img src="header.png" height="100" />
	</div>
</div>
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('chapter_jit_notification.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Jitter Object Registration and Notification </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In Jitter, matrices are passed around as named references between Max objects.</p>
<p>This named reference is created since Jitter registers these matrices with the corresponding name using the <a class="el" href="group__objectmod.html#gabcf088a00f36b6af8ce5896b81e4d0ef" title="Registers an object in the named object registry. ">jit_object_register()</a> function. Object registration is useful for a few reasons. First, registered matrices can be resolved by name using the <a class="el" href="group__objectmod.html#ga328c0beb469f32437b756852fe8583bf" title="Retrieves a registered object associated with name. ">jit_object_findregistered()</a> function. Secondly, registered objects can sent event notification to clients who have attached to them using <a class="el" href="group__objectmod.html#ga213166e8beeb29aca36c57cd07c722f1" title="Attaches an object as a client of a named server object for notification. ">jit_object_attach()</a>. Lastly, under certain circumstances, the object registration process can be used to have multiple external references to a single instance of an object as is the case with jit.matrix.</p>
<h1><a class="anchor" id="chapter_jit_notification_reg"></a>
Registering Named Objects</h1>
<p>To register an object, one can use the <a class="el" href="group__objectmod.html#gabcf088a00f36b6af8ce5896b81e4d0ef" title="Registers an object in the named object registry. ">jit_object_register()</a> function, which is equivalent to the Max <a class="el" href="group__obj.html#gaaa97beba179d6aebd3f3ede1b5c781fa" title="Registers an object in a namespace. ">object_register()</a> function in the namespace associated with gensym("jitter"). Traditionally in Jitter, we bind <a class="el" href="group__objectmod.html#gabcf088a00f36b6af8ce5896b81e4d0ef" title="Registers an object in the named object registry. ">jit_object_register()</a> to the "register" method for an object and use jit_object_method() to call this method. For example, from the jit.notify SDK example:</p>
<div class="fragment"><div class="line"><span class="comment">// allocate the Jitter object</span></div>
<div class="line"><span class="keywordflow">if</span> (o=jit_object_new(<a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;jit_notify&quot;</span>))) {</div>
<div class="line">   ...</div>
<div class="line">   <span class="comment">// generate a unique name</span></div>
<div class="line">   x-&gt;servername = jit_symbol_unique();</div>
<div class="line"></div>
<div class="line">   <span class="comment">// register the object with the given name</span></div>
<div class="line">   jit_object_method(o,<a class="code" href="group__jitter.html#ga29795611fa191ac595574fb5ea6cfe46">_jit_sym_register</a>,x-&gt;servername);</div>
<div class="line">   ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>If not using a specific name, it is good to use the jit_symbol_unique() function as above to generate a unique name which is slated for re-use once a registered object is freed. This prevents excess memory usage by the symbol table as associated with these unique names.</p>
<p>If you wish the object to have multiple references to a single instance with some name, as is common with the jit.matrix object, it is essential to use the return value of <a class="el" href="group__objectmod.html#gabcf088a00f36b6af8ce5896b81e4d0ef" title="Registers an object in the named object registry. ">jit_object_register()</a> in any instance where the object pointer is saved after registration. This is because if the registered object with the same class already exists, the object attempting to be registered will be freed, and the already registered object of the same class will be returned, its reference count having been incremented. This is not typically an issue outside of registering jit.matrix objects, although you may have a need for this type of implementation in other situations. Most other situations in which object registration is used within Jitter only expects and/or permits a single instance to be registered. In the above example, we know that this is safe to do, as we are using jit_symbol_unique() to generate a unique name.</p>
<p>It is also possible to unregister named objects, with the <a class="el" href="group__objectmod.html#ga21f77a08c1a98aaf68e4b2913487be0f" title="Unregisters an object from the named object registry. ">jit_object_unregister()</a> function, but typically this is handled for you when your object is freed, or if your object is registered again with a different name. This is not often used in the Jitter code base except within these contexts.</p>
<h1><a class="anchor" id="chapter_jit_notification_lookup"></a>
Looking Up an Object by Name</h1>
<p>Registered objects can be found by name using the <a class="el" href="group__objectmod.html#ga328c0beb469f32437b756852fe8583bf" title="Retrieves a registered object associated with name. ">jit_object_findregistered()</a> function. For example named matrices are resolved using this function. Most Matrix Operator objects have this done for them by the default MOP code, but for example any MOP which has its own jit_matrix method, such as the jit.pack SDK example will make use of <a class="el" href="group__objectmod.html#ga328c0beb469f32437b756852fe8583bf" title="Retrieves a registered object associated with name. ">jit_object_findregistered()</a> inside its jit_matrix method:</p>
<div class="fragment"><div class="line"><span class="comment">// get our matrix name from the atom arguments provided</span></div>
<div class="line">matrixname = <a class="code" href="group__atommod.html#ga73b81472812e4c5475d07d9914d84f89">jit_atom_getsym</a>(argv);</div>
<div class="line"></div>
<div class="line"><span class="comment">// look up based on name</span></div>
<div class="line">matrix = <a class="code" href="group__objectmod.html#ga328c0beb469f32437b756852fe8583bf">jit_object_findregistered</a>(matrixname);</div>
<div class="line"></div>
<div class="line"><span class="comment">// make sure that it is a valid pointer and has a &quot;class_jit_matrix&quot; method which returns 1</span></div>
<div class="line"><span class="keywordflow">if</span> (matrix&amp;&amp;jit_object_method(matrix, <a class="code" href="group__jitter.html#gaf40e2ae563670b30c6a0d52bc536cfd4">_jit_sym_class_jit_matrix</a>)) {</div>
<div class="line">   ...</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="chapter_jit_notification_attach"></a>
Attaching to Named Objects</h1>
<p>Once an object has been registered, it can be considered a server to which clients attach to be notified of various events. To attach to a named object, use the the <a class="el" href="group__objectmod.html#ga213166e8beeb29aca36c57cd07c722f1" title="Attaches an object as a client of a named server object for notification. ">jit_object_attach()</a> function. Similarly to detach from a named object, use the <a class="el" href="group__objectmod.html#gaa286218b643371fe28cbe261facd5b21" title="Detaches a client object from a named server object. ">jit_object_detach()</a> function. It is typical to detach from a server in your object's destructor, or any time your object is switching which server it is attached to. For your client object to receive any notification from the server object, it is important for your object to have defined a "notify" method which will receive the notification from all objects it is attached to.</p>
<p>Below is the jit.notify SDK example's max wrapper object's notify method, which receives some atom values from its internal Jitter object instance. Since this object is a Matrix Operator, it is important in the following example that jit.notify calls the <a class="el" href="group__maxmopmod.html#ga7e08584771f58ce1fe0b190d27b5759b" title="Adds default methods and attributes to the MOP Max wrapper class. ">max_jit_classex_mop_wrap()</a> function with the <a class="el" href="group__jitter.html#ga669c2f28bba1dfb4181ebae8f19488bc" title="mop flag ">MAX_JIT_MOP_FLAGS_OWN_NOTIFY</a> flag to override the default MOP notify method, and that we pass on all other messages to the standard <a class="el" href="group__maxmopmod.html#ga5032d682c77bcb7e2dcdf0e77d863d3c" title="Default notify method for a MOP Max wrapper object. ">max_jit_mop_notify()</a> method so that the default MOP code is informed of any changes to the input and output matrices.</p>
<div class="fragment"><div class="line"><span class="comment">// s is the servername, msg is the message, ob is the server object pointer,</span></div>
<div class="line"><span class="comment">// and data is extra data the server might provide for a given message</span></div>
<div class="line"><span class="keywordtype">void</span> max_jit_notify_notify(t_max_jit_notify *x, <a class="code" href="structt__symbol.html">t_symbol</a> *s, <a class="code" href="structt__symbol.html">t_symbol</a> *msg, <span class="keywordtype">void</span> *ob, <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">if</span> (msg==<a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;splat&quot;</span>)) {</div>
<div class="line">      <a class="code" href="group__console.html#ga8eebb1400d598f4423f925102d02970a">post</a>(<span class="stringliteral">&quot;notify: server=%s message=%s&quot;</span>,s-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8">s_name</a>,msg-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8">s_name</a>);</div>
<div class="line">      <span class="keywordflow">if</span> (!data) {</div>
<div class="line">         <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757">error</a>(<span class="stringliteral">&quot;splat message NULL pointer&quot;</span>);</div>
<div class="line">         <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// here&#39;s where we output using the rightmost outlet</span></div>
<div class="line">      <span class="comment">// we just happen to know that &quot;data&quot; points to a t_atom[3]</span></div>
<div class="line">      <span class="comment">// alternately you could use max_jit_obex_dumpout_get just to get</span></div>
<div class="line">      <span class="comment">// the outlet pointer</span></div>
<div class="line">      <a class="code" href="group__maxwrapmod.html#ga161cd54f4612d26057e4140b56e14729">max_jit_obex_dumpout</a>(x,msg,3,(<a class="code" href="structt__atom.html">t_atom</a> *)data);</div>
<div class="line">   } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">// since we are a MOP, we are also attached to all the matrices for each input/output</span></div>
<div class="line">      <span class="comment">// so we need to deal with this by calling the default mop notify method</span></div>
<div class="line">      <span class="comment">// (this is how mops handle their matrices getting new names/freed/modified)</span></div>
<div class="line">      <a class="code" href="group__maxmopmod.html#ga5032d682c77bcb7e2dcdf0e77d863d3c">max_jit_mop_notify</a>(x,s,msg);</div>
<div class="line">   }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="chapter_jit_notification_notify"></a>
Notifying Clients</h1>
<p>If you are making an object which is to be registered, and wish to send custom notification to clients in addition to the default notification that attributes send to all clients when the attribute is modified, and the default object free notification, then you will want to use the <a class="el" href="group__objectmod.html#ga4bbd50b2d1e34de44d36e1a66a477b9f" title="Notifies all client objects for a named server object. ">jit_object_notify()</a> function. This function lets you determine a message name to use for notification and optionally specify additional, but untyped data to all clients. If you choose to send additional data to clients, it is necessary for all client code to know how to unpack this information. Below is the example from the jit.notify SDK example which uses the notification mechanism to send some data to its max wrapper object:</p>
<div class="fragment"><div class="line"><a class="code" href="structt__atom.html">t_atom</a> foo[3];</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__atommod.html#ga0ad1eac4cdeb76a48a3056d83759276b">jit_atom_setlong</a>(&amp;foo[0],1);</div>
<div class="line"><a class="code" href="group__atommod.html#ga0ad1eac4cdeb76a48a3056d83759276b">jit_atom_setlong</a>(&amp;foo[1],2);</div>
<div class="line"><a class="code" href="group__atommod.html#ga0ad1eac4cdeb76a48a3056d83759276b">jit_atom_setlong</a>(&amp;foo[2],3);</div>
<div class="line"><a class="code" href="group__objectmod.html#ga4bbd50b2d1e34de44d36e1a66a477b9f">jit_object_notify</a>(x,<a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;splat&quot;</span>), foo);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
		<div id="c74footer">
			&nbsp;&nbsp;Copyright &copy; 2013, <a href="http://www.cycling74.com/">Cycling '74</a>
		</div>
	</body>
</html>
