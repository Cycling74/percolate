<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Max 6 API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
	<div id="c74header">
		<img src="header.png" height="100" />
	</div>
</div>
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('chapter_enhancements.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Enhancements to Objects </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="chapter_enhancements_presets"></a>
Preset Support</h1>
<p>Presets are a simple state-saving mechanism. Your object receives a preset message when state is being saved. You respond by creating a message that will be sent back to your object when the preset is recalled.</p>
<p>For more powerful and general state-saving, use the pattr system described below.</p>
<p>To support saving a single integer in a preset, you can use the <a class="el" href="group__presets.html#gabb360be027245770f96cee996c2759be" title="Restore the state of your object with an int message. ">preset_int()</a> convenience function. The <a class="el" href="group__presets.html#gabb360be027245770f96cee996c2759be" title="Restore the state of your object with an int message. ">preset_int()</a> function records an int message with the value you pass it in the preset, to be sent back to your object at a later time.</p>
<div class="fragment"><div class="line"><a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#ga4b2c39d5bd0b08acd10bffed77f0e513">method</a>)myobject_preset, <span class="stringliteral">&quot;preset&quot;</span>, 0);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> myobject_preset(t_myobject *x)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__presets.html#gabb360be027245770f96cee996c2759be">preset_int</a>(x, x-&gt;m_currentvalue);</div>
<div class="line">}</div>
</div><!-- fragment --><p>More generally, you can use <a class="el" href="group__presets.html#ga5f6d86fdc24e371604b764e7581a4fcb" title="Give the preset object a general message to restore the current state of your object. ">preset_store()</a>. Here is an example of storing two values (m_xvalue and m_yvalue) in a list. </p><div class="fragment"><div class="line"><a class="code" href="group__presets.html#ga5f6d86fdc24e371604b764e7581a4fcb">preset_store</a>(<span class="stringliteral">&quot;ossll&quot;</span>, x, ob_sym(x), <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;list&quot;</span>), x-&gt;m_xvalue, x-&gt;m_yvalue);</div>
</div><!-- fragment --><h1><a class="anchor" id="chapter_enhancements_pattr"></a>
Pattr Support</h1>
<p>In most cases, you need only to define your object's state using <a class="el" href="chapter_msgattached.html#chapter_msgattached_attrs">Attributes</a> and it will be ready for use with Max's pattr system. For more complex scenarios you may also wish to investigate <a class="el" href="group__obj.html#ga6297b81c3a70f7fb2201c7262e96bba3" title="Broadcast a message (with an optional argument) from a registered object to any attached client objec...">object_notify()</a>, <a class="el" href="group__obj.html#ga42025069e4317aef6dbe5c21c316fd85" title="Attaches a client to a registered object. ">object_attach()</a>, and the section on <a class="el" href="chapter_msgattached.html#chapter_msgattached_receiving">Receiving Notifications</a>.</p>
<h1><a class="anchor" id="chapter_enhancements_assistance"></a>
Assistance</h1>
<p>To show descriptions of your object's inlets and outlets while editing a patcher, your object can respond to the assist message with a function that copies the text to a string.</p>
<div class="fragment"><div class="line"><a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#ga4b2c39d5bd0b08acd10bffed77f0e513">method</a>)myobject_assist, <span class="stringliteral">&quot;assist&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a">A_CANT</a>, 0);</div>
</div><!-- fragment --><p>The function below has two inlets and one outlet. The io argument will be 1 for inlets, 2 for outlets. The index argument will be 0 for the leftmost inlet or outlet. You can copy a maximum of 512 characters to the output string s. You can use <a class="el" href="group__misc.html#ga9c07aa8c37f8fc3180911f94091e7446" title="Copy the contents of one string to another, in a manner safer than the standard strcpy() or strncpy()...">strncpy_zero()</a> to copy the string, or if you want to format the assistance string based on a current value in the object, you could use <a class="el" href="group__misc.html#gab82e9c5bbc8b7fe70d16b1f6383f1cc4" title="Copy the contents of a string together with value substitutions, in a manner safer than the standard ...">snprintf_zero()</a>.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> myobject_assist(t_myobject *x, <span class="keywordtype">void</span> *b, <span class="keywordtype">long</span> io, <span class="keywordtype">long</span> index, <span class="keywordtype">char</span> *s)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (io) {</div>
<div class="line">        <span class="keywordflow">case</span> 1:</div>
<div class="line">            <span class="keywordflow">switch</span> (index) {</div>
<div class="line">                <span class="keywordflow">case</span> 0:</div>
<div class="line">                    <a class="code" href="group__misc.html#ga9c07aa8c37f8fc3180911f94091e7446">strncpy_zero</a>(s, <span class="stringliteral">&quot;This is a description of the leftmost inlet&quot;</span>, 512);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 1:</div>
<div class="line">                    <a class="code" href="group__misc.html#ga9c07aa8c37f8fc3180911f94091e7446">strncpy_zero</a>(s, <span class="stringliteral">&quot;This is a description of the rightmost inlet&quot;</span>, 512);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">            <a class="code" href="group__misc.html#ga9c07aa8c37f8fc3180911f94091e7446">strncpy_zero</a>(s, <span class="stringliteral">&quot;This is a description of the outlet&quot;</span>, 512);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="chapter_enhancements_hotness"></a>
Hot and Cold Inlets</h1>
<p>Objects such as operators (+, -, etc.) and the int object have inlets that merely store values rather than performing an operation and producing output. These inlets are labeled with a blue color to indicate they are "cold" rather than action-producing "hot" inlets. To implement this labeling, your object can respond to the inletinfo message.</p>
<div class="fragment"><div class="line"><a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#ga4b2c39d5bd0b08acd10bffed77f0e513">method</a>)myobject_inletinfo, <span class="stringliteral">&quot;inletinfo&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a">A_CANT</a>, 0);</div>
</div><!-- fragment --><p>If all of your object's non-left inlets are "cold" you can use the function stdinletinfo() instead of writing your own, as shown below: </p><div class="fragment"><div class="line"><a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#ga4b2c39d5bd0b08acd10bffed77f0e513">method</a>)stdinletinfo, <span class="stringliteral">&quot;inletinfo&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a">A_CANT</a>, 0);</div>
</div><!-- fragment --><p>To write your own function, just look at the index argument (which is 0 for the left inlet). This example turns the third inlet cold. You don't need to do anything for "hot" inlets.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> myobject_inletinfo(t_myobject *x, <span class="keywordtype">void</span> *b, <span class="keywordtype">long</span> index, <span class="keywordtype">char</span> *t)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (index == 2)</div>
<div class="line">         *t = 1;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="chapter_enhancements_ed"></a>
Showing a Text Editor</h1>
<p>Objects such as coll and text display a text editor window when you double-click. Users can edit the contents of the objects and save the updated data (or not). Here's how to do the same thing in your object.</p>
<p>First, if you want to support double-clicking on a non-UI object, you can respond to the dblclick message.</p>
<div class="fragment"><div class="line"><a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#ga4b2c39d5bd0b08acd10bffed77f0e513">method</a>)myobject_dblclick, <span class="stringliteral">&quot;dblclick&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a">A_CANT</a>, 0);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> myobject_dblclick(t_myobject *x)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// open editor here</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>You'll need to add a <a class="el" href="structt__object.html" title="The structure for the head of any object which wants to have inlets or outlets, or support attributes...">t_object</a> pointer to your object's data structure to hold the editor.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_myobject</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="structt__object.html">t_object</a> m_obj;</div>
<div class="line">    <a class="code" href="structt__object.html">t_object</a> *m_editor;</div>
<div class="line">} t_myobject;</div>
</div><!-- fragment --><p>Initialize the m_editor field to NULL in your new instance routine. Then implement the dblclick method as follows: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (!x-&gt;m_editor)</div>
<div class="line">    x-&gt;m_editor = <a class="code" href="group__obj.html#gac4b370265c776db4f545d257089af1cf">object_new</a>(<a class="code" href="group__class.html#ga090d3cbc4f137661806fc1b72249a791">CLASS_NOBOX</a>, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;jed&quot;</span>), (<a class="code" href="structt__object.html">t_object</a> *)x, 0);</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">    object_attr_setchar(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;visible&quot;</span>), 1);</div>
</div><!-- fragment --><p>The code above does the following: If the editor does not exist, we create one by making a "jed" object and passing our object as an argument. This permits the editor to tell our object when the window is closed.</p>
<p>If the editor does exist, we set its visible attribute to 1, which brings the text editor window to the front.</p>
<p>To set the text of the edit window, we can send our jed object the settext message with a zero-terminated buffer of text. We also provide a symbol specifying how the text is encoded. For best results, the text should be encoded as UTF-8. Here is an example where we set a string to contain "Some text to edit" then pass it to the editor.</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> text[512];</div>
<div class="line"></div>
<div class="line">strcpy(text,<span class="stringliteral">&quot;Some text to edit&quot;</span>);</div>
<div class="line"><a class="code" href="group__obj.html#gae740749094827ac5adc2b7145db1c596">object_method</a>(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;settext&quot;</span>), text, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;utf-8&quot;</span>));</div>
</div><!-- fragment --><p>The title attribute sets the window title of the text editor. </p><div class="fragment"><div class="line"><a class="code" href="group__attr.html#ga642c3b5686b08880194f74c0d5149bcf">object_attr_setsym</a>(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;title&quot;</span>), <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;crazytext&quot;</span>));</div>
</div><!-- fragment --><p>When the user closes the text window, your object (or the object you passed as an argument when creating the editor) will be sent the edclose message. </p><div class="fragment"><div class="line"><a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#ga4b2c39d5bd0b08acd10bffed77f0e513">method</a>)myobject_edclose, <span class="stringliteral">&quot;edclose&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a">A_CANT</a>, 0);</div>
</div><!-- fragment --><p>The edclose method is responsible for doing something with the text. It should also zero the reference to the editor stored in the object, because it will be freed. A pointer to the text pointer is passed, along with its size. The encoding of the text is always UTF-8.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> myobject_edclose(t_myobject *x, <span class="keywordtype">char</span> **ht, <span class="keywordtype">long</span> size)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// do something with the text</span></div>
<div class="line">    x-&gt;m_editor = NULL;</div>
<div class="line">}</div>
</div><!-- fragment --><p>If your object will be showing the contents of a text file, you are still responsible for setting the initial text, but you can assign a file so that the editor will save the text data when the user chooses Save from the File menu. To assign a file, use the filename message, assuming you have a filename and path ID.</p>
<div class="fragment"><div class="line"><a class="code" href="group__obj.html#gae740749094827ac5adc2b7145db1c596">object_method</a>(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;filename&quot;</span>), x-&gt;m_myfilename, x-&gt;m_mypath);</div>
</div><!-- fragment --><p>The filename message will set the title of the text editor window, but you can use the title attribute to override the simple filename. For example, you might want the name of your object to precede the filename: </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> titlename[512];</div>
<div class="line"></div>
<div class="line">sprintf(titlename, <span class="stringliteral">&quot;myobject: %s&quot;</span>, x-&gt;m_myfilename);</div>
<div class="line"><a class="code" href="group__attr.html#ga642c3b5686b08880194f74c0d5149bcf">object_attr_setsym</a>(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;title&quot;</span>), <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(titlename));</div>
</div><!-- fragment --><p>Each time the user chooses Save, your object will receive an edsave message. If you return zero from your edsave method, the editor will proceed with saving the text in a file. If you return non-zero, the editor assumes you have taken care of saving the text. The general idea is that when the user wants to save the text, it is either updated inside your object, updated in a file, or both. As an example, the js object uses its edsave message to trigger a recompile of the Javascript code. But it also returns 0 from its edsave method so that the text editor will update the script file. Except for the return value, the prototype of the edsave method is identical to the edclose method.</p>
<div class="fragment"><div class="line"><a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#ga4b2c39d5bd0b08acd10bffed77f0e513">method</a>)myobject_edsave, <span class="stringliteral">&quot;edsave&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a">A_CANT</a>, 0);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">long</span> myobject_edsave(t_myobject *x, <span class="keywordtype">char</span> **ht, <span class="keywordtype">long</span> size)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// do something with the text</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;       <span class="comment">// tell editor it can save the text</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="chapter_enhancements_tables"></a>
Accessing Data in table Objects</h1>
<p>Table objects can be given names as arguments. If a table object has a name, you can access the data using <a class="el" href="group__tables.html#ga2c08d1383a235eb8c106c0f3afea6d21" title="Get a handle to the data in a named table object. ">table_get()</a>. Supply a symbol, as well as a place to assign a pointer to the data and the length. The following example accesses a table called foo, and, if found, posts all its values.</p>
<div class="fragment"><div class="line"><span class="keywordtype">long</span> **data = NULL;</div>
<div class="line"><span class="keywordtype">long</span> i, size;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__tables.html#ga2c08d1383a235eb8c106c0f3afea6d21">table_get</a>(<a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;foo&quot;</span>), &amp;data, &amp;size)) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0;  i &lt; size; i++) {</div>
<div class="line">            <a class="code" href="group__console.html#ga8eebb1400d598f4423f925102d02970a">post</a>(<span class="stringliteral">&quot;%ld: %ld&quot;</span>,i,(*data)[i]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p>You can also write data into the table. If you would like the table editor to redraw after doing so, use <a class="el" href="group__tables.html#gaa72449d4792a6108489ef63c5f5ba7a3" title="Mark a table object as having changed data. ">table_dirty()</a>. Here's an example where we set all values in the table to zero, then notify the table to redraw.</p>
<div class="fragment"><div class="line"><span class="keywordtype">long</span> **data = NULL;</div>
<div class="line"><span class="keywordtype">long</span> i, size;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__tables.html#ga2c08d1383a235eb8c106c0f3afea6d21">table_get</a>(<a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;foo&quot;</span>), &amp;data, &amp;size)) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0;  i &lt; size; i++) {</div>
<div class="line">            (*data)[i]  = 0;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="group__tables.html#gaa72449d4792a6108489ef63c5f5ba7a3">table_dirty</a>(<a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(<span class="stringliteral">&quot;foo&quot;</span>));</div>
<div class="line">    }</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
		<div id="c74footer">
			&nbsp;&nbsp;Copyright &copy; 2013, <a href="http://www.cycling74.com/">Cycling '74</a>
		</div>
	</body>
</html>
