<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Max 6 API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
	<div id="c74header">
		<img src="header.png" height="100" />
	</div>
</div>
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('chapter_jit_jxf.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">JXF File Specification </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Jitter File Format (JXF) stores matrix data in a binary (not human-readable) form.</p>
<p>When using Jitter you can create JXF files by sending the write message to a jit.matrix object. Conversely you can read JXF files from disk using the read message. This section will cover first the API functions that one can use from C to read and write JXF files. Then it will break down the file format at the bit level.</p>
<h1><a class="anchor" id="chapter_jit_jxf_api"></a>
The Binary JXF API</h1>
<p>Most Jitter users do not need or want to know about the internal binary format of a JXF-file. Even users who want to read and write JXF-files from C do not need to know the internal details if they use the functions of the Jitter API for the binary interface. Not only is the API more convenient, but using the functions provided by Cycling '74 may protect your code from having to be altered in the future in the event of a specification change.</p>
<p>There are two primary functions one should use to read data from a JXF file. <a class="el" href="group__binmod.html#ga362ab038ae5f13336dfb26cf004cf950" title="Reads the header of a JXF binary file. ">jit_bin_read_header()</a> reads the version number and the size of the file from the header, and has the following signature:</p>
<div class="fragment"><div class="line">t_jit_err <a class="code" href="group__binmod.html#ga362ab038ae5f13336dfb26cf004cf950">jit_bin_read_header</a>(<a class="code" href="group__files.html#ga97be3130fc4b5da33f4b69ce9dedd5af">t_filehandle</a> fh, ulong *version, <span class="keywordtype">long</span> *filesize)</div>
</div><!-- fragment --><p><a class="el" href="group__binmod.html#gae1bd457360f302d87be427c0bcf76b9d" title="Reads matrix data from a JXF binary file. ">jit_bin_read_matrix()</a> imports matrix data from a file to a matrix, resizing the matrix if necessary, and has the following signature:</p>
<div class="fragment"><div class="line">t_jit_err <a class="code" href="group__binmod.html#gae1bd457360f302d87be427c0bcf76b9d">jit_bin_read_matrix</a>(<a class="code" href="group__files.html#ga97be3130fc4b5da33f4b69ce9dedd5af">t_filehandle</a> fh, <span class="keywordtype">void</span> *matrix)</div>
</div><!-- fragment --><p>Here’s a chunk of code that shows how to read a matrix from disk:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!(err=<a class="code" href="group__files.html#ga6c687155c75742612024b403d7010ae4">path_opensysfile</a>(filename, path, &amp;fh, READ_PERM))) {</div>
<div class="line">   <span class="comment">//all is well</span></div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757">error</a>(<span class="stringliteral">&quot;jit.matrix: can&#39;t open file %s&quot;</span>,name-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8">s_name</a>);</div>
<div class="line">   <span class="keywordflow">goto</span> out;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#ga362ab038ae5f13336dfb26cf004cf950">jit_bin_read_header</a>(fh,&amp;version,&amp;filesize)) {</div>
<div class="line">   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757">error</a>(<span class="stringliteral">&quot;jit.matrix: improper file format %s&quot;</span>,name-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8">s_name</a>);</div>
<div class="line">   <a class="code" href="group__files.html#ga51b7b9a18ed315d383a4ad4542d3ff09">sysfile_close</a>(fh);</div>
<div class="line">   <span class="keywordflow">goto</span> out;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#gae1bd457360f302d87be427c0bcf76b9d">jit_bin_read_matrix</a>(fh,matrix)) {</div>
<div class="line">   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757">error</a>(<span class="stringliteral">&quot;jit.matrix: improper file format %s&quot;</span>,name-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8">s_name</a>);</div>
<div class="line">   <a class="code" href="group__files.html#ga51b7b9a18ed315d383a4ad4542d3ff09">sysfile_close</a>(fh);</div>
<div class="line">   <span class="keywordflow">goto</span> out;</div>
<div class="line">}</div>
<div class="line"><a class="code" href="group__files.html#ga51b7b9a18ed315d383a4ad4542d3ff09">sysfile_close</a>(fh);</div>
</div><!-- fragment --><p>Similarly there are two functions one should use when writing data to a JXF file. <a class="el" href="group__binmod.html#ga5a6598d034148dd12782383ea9b1bf31" title="Writes the header of a JXF binary file. ">jit_bin_write_header()</a> writes a header to a file, and has the following signature:</p>
<div class="fragment"><div class="line">t_jit_err <a class="code" href="group__binmod.html#ga5a6598d034148dd12782383ea9b1bf31">jit_bin_write_header</a>(<a class="code" href="group__files.html#ga97be3130fc4b5da33f4b69ce9dedd5af">t_filehandle</a> fh, <span class="keywordtype">long</span> filesize)</div>
</div><!-- fragment --><p><a class="el" href="group__binmod.html#ga8102ed7929a540a5584505049870887a" title="Writes a matrix to a JXF binary file. ">jit_bin_write_matrix()</a> writes a matrix to a file, and has the following signature:</p>
<div class="fragment"><div class="line">t_jit_err <a class="code" href="group__binmod.html#ga8102ed7929a540a5584505049870887a">jit_bin_write_matrix</a>(<a class="code" href="group__files.html#ga97be3130fc4b5da33f4b69ce9dedd5af">t_filehandle</a> fh, <span class="keywordtype">void</span> *matrix)</div>
</div><!-- fragment --><p>Here’s a section of code that shows how you might write a file with one matrix. Note that the initial filesize argument to <a class="el" href="group__binmod.html#ga5a6598d034148dd12782383ea9b1bf31" title="Writes the header of a JXF binary file. ">jit_bin_write_header()</a> is bogus, but that the header is written again at the end of the operation when the filesize can be determined from the file position after writing the matrix.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (err=<a class="code" href="group__files.html#gafd6e5cccc1eb10df5c58b51ca9df4f81">path_createsysfile</a>(filename, path, type, &amp;fh)) {</div>
<div class="line">   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757">error</a>(<span class="stringliteral">&quot;jit.matrix: could not create file %s&quot;</span>,name-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8">s_name</a>);</div>
<div class="line">   <span class="keywordflow">goto</span> out;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#ga5a6598d034148dd12782383ea9b1bf31">jit_bin_write_header</a>(fh,0)) {</div>
<div class="line">   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757">error</a>(<span class="stringliteral">&quot;jit.matrix: could not write header %s&quot;</span>, matrixName-&gt;s_name);</div>
<div class="line">   <a class="code" href="group__files.html#ga51b7b9a18ed315d383a4ad4542d3ff09">sysfile_close</a>(fh);</div>
<div class="line">   <span class="keywordflow">goto</span> out;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#ga8102ed7929a540a5584505049870887a">jit_bin_write_matrix</a>(fh,pointerToMatrix)) {</div>
<div class="line">   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757">error</a>(<span class="stringliteral">&quot;jit.matrix: could not write matrix %s&quot;</span>, matrixName-&gt;s_name);</div>
<div class="line">   <a class="code" href="group__files.html#ga51b7b9a18ed315d383a4ad4542d3ff09">sysfile_close</a>(fh);</div>
<div class="line">   <span class="keywordflow">goto</span> out;</div>
<div class="line">}</div>
<div class="line"><a class="code" href="group__files.html#ga512ef5b9dd2dc59af297855ef41feeed">sysfile_getpos</a>(fh, &amp;position);</div>
<div class="line"><a class="code" href="group__files.html#gab1d9497cbc76035be73118b4f34a2e0b">sysfile_seteof</a>(fh, position);</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#ga5a6598d034148dd12782383ea9b1bf31">jit_bin_write_header</a>(fh,position)) {</div>
<div class="line">   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757">error</a>(<span class="stringliteral">&quot;jit.matrix: could not write header %s&quot;</span>,</div>
<div class="line">matrixName-&gt;s_name);</div>
<div class="line">   <a class="code" href="group__files.html#ga51b7b9a18ed315d383a4ad4542d3ff09">sysfile_close</a>(fh);</div>
<div class="line">   <span class="keywordflow">goto</span> out;</div>
<div class="line">}</div>
<div class="line"><a class="code" href="group__files.html#ga51b7b9a18ed315d383a4ad4542d3ff09">sysfile_close</a>(fh);</div>
</div><!-- fragment --><h1><a class="anchor" id="chapter_jit_jxf_spec"></a>
Specification of the JXF Format</h1>
<p>The internal format of JXF-files is based on the Interchange File Format (IFF) (<a href="http://en.wikipedia.org/wiki/Interchange_File_Format">http://en.wikipedia.org/wiki/Interchange_File_Format</a>). An IFF file is built up from chunks. All data in IFF files is big-endian. Several convenience macros defined in jit.byteorder.h are available to help convert numbers to the proper format before and after they're written to and read from a JXF file: BE_I32() can be called on 32-bit integers, BE_F32() on 32-bit floats, and BE_F64() on 64-bit doubles.</p>
<p>Each chunk in an IFF file begins with a four character Type ID. This is followed by a 32-bit unsigned integer specifying the size of the chunk content in bytes. In a JXF file, the 32-bit integer part of the first chunk tells us the size of the file, and all the subsequent chunks, which begin immediately after the first chunk, contain matrices. In the future chunks may also be used to store other kinds of data.</p>
<p>Here is a tabular overview of an example minimal JXF file.</p>
<p>Container Chunk</p>
<table class="doxtable">
<tr>
<td>groupID </td><td>JIT_BIN_CHUNK_CONTAINER ('FORM')  </td></tr>
<tr>
<td>File size </td><td>32-bit int  </td></tr>
<tr>
<td>IFF Type </td><td>JIT_BIN_FORMAT ('JIT!')  </td></tr>
<tr>
<td>Format Chunk </td></tr>
<tr>
<td></td></tr>
<tr>
<td>chunkID </td><td>JIT_BIN_CHUNK_FORMAT_VERSION ('FVER')  </td></tr>
<tr>
<td>Chunk size </td><td>12 bytes  </td></tr>
<tr>
<td>Version </td><td>JIT_BIN_VERSION_1 (0x3C93DC80)  </td></tr>
<tr>
<td>Matrix Chunk </td><td></td></tr>
<tr>
<td>chunk ID </td><td>JIT_BIN_CHUNK_MATRIX ('MTRX')  </td></tr>
<tr>
<td>chunk size </td><td>32-bit int  </td></tr>
<tr>
<td>offset </td><td>32-bit int  </td></tr>
<tr>
<td>type </td><td>4-char  </td></tr>
<tr>
<td>planecount </td><td>32-bit int  </td></tr>
<tr>
<td>dimcount </td><td>32-bit int  </td></tr>
<tr>
<td>dim </td><td>Array of 32-bit ints that contain the dimensions  </td></tr>
<tr>
<td>data </td><td></td></tr>
</table>
<p>The data offset of the matrix chunk represents the offset, in bytes, from the beginning of the chunk to the beginning of the data portion of the chunk. The type is one of CHAR, LONG, FL32 and FL64. The dim array contains dimcount elements, each of which is a 32-bit int. The data portion consists of the cells of the matrix written out one at a time in row-major order. Planar data is multiplexed in each cell. For example, a 3-plane 2 by 2 matrix would be written out in the following order:</p>
<table class="doxtable">
<tr>
<td>Plane </td><td>Dim 0 </td><td>Dim 1  </td></tr>
<tr>
<td>0 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>1 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>2 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>0 </td><td>1 </td><td>0  </td></tr>
<tr>
<td>1 </td><td>1 </td><td>0  </td></tr>
<tr>
<td>2 </td><td>1 </td><td>0  </td></tr>
<tr>
<td>0 </td><td>0 </td><td>1  </td></tr>
<tr>
<td>1 </td><td>0 </td><td>1  </td></tr>
<tr>
<td>2 </td><td>0 </td><td>1  </td></tr>
<tr>
<td>0 </td><td>1 </td><td>1  </td></tr>
<tr>
<td>1 </td><td>1 </td><td>1  </td></tr>
<tr>
<td>2 </td><td>1 </td><td>1  </td></tr>
</table>
<p>The various chunks discussed above can be represented by the C structs listed below:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_jit_bin_chunk_container</div>
<div class="line">{</div>
<div class="line">   ulong   ckid;       <span class="comment">//&#39;FORM&#39;</span></div>
<div class="line">   <span class="keywordtype">long</span>   cksize;      <span class="comment">//filesize</span></div>
<div class="line">   ulong   formtype;   <span class="comment">//&#39;JIT!&#39;</span></div>
<div class="line">} t_jit_bin_chunk_container;</div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_jit_bin_chunk_format_version</div>
<div class="line">{</div>
<div class="line">   ulong   ckid;       <span class="comment">//&#39;FVER&#39;</span></div>
<div class="line">   <span class="keywordtype">long</span>   cksize;      <span class="comment">//12</span></div>
<div class="line">   ulong   vers;      <span class="comment">//timestamp</span></div>
<div class="line">} t_jit_bin_chunk_format_version;</div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_jit_bin_chunk_matrix</div>
<div class="line">{</div>
<div class="line">   ulong   ckid;       <span class="comment">//&#39;MTRX&#39;</span></div>
<div class="line">   <span class="keywordtype">long</span>   cksize;      <span class="comment">//varies(should be equal to</span></div>
<div class="line">               <span class="comment">//24+(4*dimcount)+(typesize*planecount*totalpoints))</span></div>
<div class="line">   <span class="keywordtype">long</span>    offset;      <span class="comment">//data offset(should be equal to 24+(4*dimcount))</span></div>
<div class="line">   ulong   type;      <span class="comment">//&#39;CHAR&#39;,&#39;LONG&#39;,&#39;FL32&#39;,&#39;FL64&#39;</span></div>
<div class="line">   <span class="keywordtype">long</span>   planecount;</div>
<div class="line">   <span class="keywordtype">long</span>   dimcount;</div>
<div class="line">   <span class="keywordtype">long</span>   dim[1];</div>
<div class="line">} t_jit_bin_chunk_matrix;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
		<div id="c74footer">
			&nbsp;&nbsp;Copyright &copy; 2013, <a href="http://www.cycling74.com/">Cycling '74</a>
		</div>
	</body>
</html>
